import { useState } from "react";
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics.js";

const firebaseConfig = {
  apiKey: "AIzaSyANu2hUSkoFgD9f1p6Vqxon9Yhd-dpRcys",
  authDomain: "webik-77081.firebaseapp.com",
  projectId: "webik-77081",
  storageBucket: "webik-77081.firebaseapp.com",
  messagingSenderId: "199199665865",
  appId: "1:199199665865:web:b3b34d1877ea27f7f9e718",
  measurementId: "G-VC7L34JMFT"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

const getWeekends = () => {
  let weekends = [];
  let start = new Date("2024-05-01");
  let end = new Date("2024-09-30");

  while (start <= end) {
    if (start.getDay() === 5) {
      let saturday = new Date(start);
      saturday.setDate(saturday.getDate() + 1);
      let sunday = new Date(start);
      sunday.setDate(sunday.getDate() + 2);
      weekends.push({
        id: `${start.toISOString().slice(0, 10)}`,
        label: `${start.toLocaleDateString()} - ${sunday.toLocaleDateString()}`,
        votes: [],
      });
    }
    start.setDate(start.getDate() + 1);
  }

  return weekends;
};

export default function VoteWeekends() {
  const [name, setName] = useState("");
  const [weekends, setWeekends] = useState(getWeekends());

  const handleVote = (id) => {
    if (!name) return alert("Vyplňte své jméno před hlasováním!");

    setWeekends((prev) =>
      prev.map((weekend) =>
        weekend.id === id && !weekend.votes.includes(name)
          ? { ...weekend, votes: [...weekend.votes, name] }
          : weekend
      )
    );
  };

  return (
    <div style={{ padding: "20px", maxWidth: "600px", margin: "auto" }}>
      <h1 style={{ fontSize: "24px", fontWeight: "bold" }}>Hlasování o víkendech</h1>
      <input
        style={{ width: "100%", padding: "10px", margin: "10px 0", border: "1px solid #ccc", borderRadius: "5px" }}
        placeholder="Zadejte své jméno"
        value={name}
        onChange={(e) => setName(e.target.value)}
      />
      <div>
        {weekends.map((weekend) => (
          <div
            key={weekend.id}
            style={{
              border: "1px solid #ddd",
              padding: "10px",
              borderRadius: "5px",
              marginBottom: "10px",
              cursor: "pointer",
            }}
            onClick={() => handleVote(weekend.id)} // Kliknutí na víkend rovnou přidá hlas
          >
            <p style={{ fontWeight: "bold" }}>{weekend.label}</p>
            <p style={{ fontSize: "14px", color: "gray" }}>
              Hlasovali: {weekend.votes.join(", ") || "Nikdo zatím nehlasoval"}
            </p>
          </div>
        ))}
      </div>
    </div>
  );
}
